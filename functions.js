// parseUri 1.2.2 // (c) Steven Levithan <stevenlevithan.com> // MIT License //
function parseUri(e){var d=parseUri.options,a=d.parser[d.strictMode?"strict":"loose"].exec(e),c={},b=14;while(b--){c[d.key[b]]=a[b]||""}c[d.q.name]={};c[d.key[12]].replace(d.q.parser,function(g,f,h){if(f){c[d.q.name][f]=h}});return c}parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};
// pushState functions // (c) Erick Tampubolon <lontongcorp.com> // GPL2 License //
if(history.pushState){jQuery(function(){if(document.location.protocol==="file:"){return}var f=jQuery(wrapper).html();var i=jQuery(wrapper).width();var h=jQuery(wrapper).height();var d=jQuery(wrapper).position().left;var m=jQuery(wrapper).position().top;var g={position:"static",left:d,top:m,width:i,height:h,background:"transparent",backgroundImage:"LOADIMG",backgroundRepeat:"no-repeat",backgroundPosition:"LOADPOS"};var c=window.History,e=0,j=c.getState(),a=j.id,k={title:jQuery("title").text(),content:jQuery("body").html()};j.title=k.title;j.data.content=k.content;j.url=document.URL;j.data.state=e++;c.saveState(j);c.Adapter.bind(window,"statechange",function(){j=c.getState();if(j.id==a){j.title=k.title;j.data.anchor="";j.data.content=k.content}var b=j.data.content;jQuery("body").html(b);jQuery.scrollTo((j.data.anchor=="")?wrapper:"#"+j.data.anchor,900,{onAfter:function(){/*!CALLBACK*/}})});jQuery("a").live("click",function(p){var q=parseUri(document.URL);var o=jQuery(this).attr("href");var b=parseUri(o);var n=jQuery(this).attr("target")?false:true;if(n){n=o.match(/wp-admin|login|feed|\.(jp*g|png|gif|bmp|css|js)/gim)?false:true}if(n){n=(b.host==q.host)}if(n){p.preventDefault();jQuery.scrollTo(jQuery(wrapper),250);if(g.backgroundImage){jQuery(wrapper).html("");jQuery(wrapper).prepend('<div id="pushState_div_loading" />');jQuery("#pushState_div_loading").css(g)}if(o.substr(0,1)=="#"||b.path.substr(0,1)=="#"){jQuery.scrollTo(o,500)}else{if(q.path==b.path){if(q.anchor!=b.anchor){jQuery.scrollTo("#"+b.anchor,500)}}else{var l={title:"",url:b.protocol+"://"+b.host+b.path,anchor:b.anchor};j=c.extractState(l.url);if(j&&j.id&&j.data.content){l.title=j.title;l.anchor=j.data.anchor;l.content=j.data.content;c.pushState({state:e++,anchor:"",content:l.content},l.title,l.url)}else{jQuery.ajax(o).done(function(r){l.title=jQuery(r).filter("title").text();r=r.replace("<body",'<body><div id="body"').replace("</body>","</div></body>");l.content=jQuery(r).filter("#body").html();c.pushState({state:e++,anchor:l.anchor,content:l.content},l.title,l.url)}).fail(function(r){data=r.responseText;l.title=jQuery(data).filter("title").text();data=data.replace("<body",'<body><div id="body"').replace("</body>","</div></body>");l.content=jQuery(data).filter("#body").html();c.pushState({state:e++,anchor:l.anchor,content:l.content},l.title,"/"+r.status+"-"+r.statusText.toLowerCase().replace(/\s/,"-"))})}}}return false}})})};
